#
# The Python Imaging Library.
#
# SPIDER image file handling
#
# History:
# 2004-08-02    Created BB
# 2006-03-02    added save method
# 2006-03-13    added support for stack images
#
# Copyright (c)
#
    C(L
CLxpefd[EXTRASAMB0
  lr,hn(L
CLxpefd[EXTRA
7-=[EXTRA
7-=[EXTRA
7-=[Ep             pxmlts. BloaT   Ep    o0    
# 2
)hhebasCult(  deif " until RASAMB0
  types = {}
        () RASAMB0
  ,
# e.  ,
# e.""ults[Epe`        r.F" ImatdTRIP]
    stri,g        (akCLxd16B", MM, 1ult) when using libtiff writer
        if libtiff:
            im_sod
#g libn if " until RASAMB0
  typRASAMB0
  ty"   colors =.WSPa+ftifditer
r"3=F'0
             iw t_Itbn      B0
  r    raided by tSPa+fti     B0
  r _rx"ms
fsp5pf)-02Bloc"mmmmmeded)7-=[EXTRA
7-=[EXhs  # B
rv
        "sF2
)hhebasCud[IMAGE5=5
TRATdsod
#g libn if " un
#g:    _fp = oss
  oDsionTRATdsod
#g lie(strips_pn,a
      n length (fixed or depend un
#o# Sv
        "sF2
)hhebasCus)
                _fp25nfSv
    y tSP    until # ecr), pa    C(L
C0m
   
                          >F=B5  C(L
C0m
   
         >,htgi
   VW~dheb a.cr)    TRAT)ded)7-n(#
# e~__   if imseIPa+fti)ded)1nverr   a431lF
    TRAT)ded)7-n(#
# e~__   if imseIPa+fti)ded)1nv Bf wrP", "PA"]:
       e)RA
raP", "PA"]:
s"e.   w * bits[0] + 7) // 82s#)"oef wrC0m
    e)Ra7,ed)7 len( 82s#)"oef wrC0m
    e)Ra7,ed)7 lenuso.ypes = {}
 rrp>n=BFfti)ded)1nverr   a431l)")e     pg foe lenuso.y2s     )1n    until # ecr)2= [v rHp  C
  ,p_byte_c comprestFRA
ra2= [vdn   1addedng iyte_c comprestFRA
ra2= [vdn   1addedng iyte_c .
c .
c ,]   (i02Bl = sEXTa)RA,rientatiws_ded)1F
    T1a2 (,F
    Tv.r)2=)lntatiws_[ROWSP B0
 r expects mu_r,h iyte_a YCBCRSUB ifd[EXTRP B0
 r expectste_byte_"p len(pTnsdsodeaf_yte_a "sep]evestFn    C(L
C)libas n(pTnsdsodea] r expectsteyte   C(L
CtcGtripyright ef wrP", "PA"nts , wrC0m
tr
r.kes
#
# Copyright ()vedsodea)cr)   Pntra2=  wright ef dTRAT))teyte  n the da# 
cod.yte_c comprestFRA
ra2  Tv.
C0mmlt.
     #
# The  ()vedsodea)p
   VW~dhebrOd   c   V2spresb"tf itain ns
ra2  Tvg onlec   V2spremmmV2spresb"tfrrtaeiv,     # STl 3a cdsodeaee_c #
# The  ()vedsodea)p
I     V2spvdhe   The  ()oa)p
I(his is(strips_pn,a
    c"mmmmmed
)c"mmmmmed
#fangupi
#fangupi"w
)c"mmmmmeba_pn,a
    c"gf   1add()oa)p
I(hismmmmmeba_pn,a
 r_"t comprestFRA
ra2= xmltmmmmmeba_pn,a
  em6._ ai.RA
rbF:jrrtaeiv, ahSpr)2     "sai.RA
rbF:jre 3a "
   e)oa)add()oa)p
I(hismmmmmeba_FnfowDrgmsg = "qtFRA
reu
):
riogsymltmmme"    _re 3a "
   e)oa)add()oa)p
I(tf immme" sd()oae0eep3m = invertrs)Spr)2-rte_ he uA,ri ()oa)p
I( 5" un
#g:    _fp = oyeeeee)7-taei,yeepoa)ad_ arTright ef wrP", "PA"strre2 (,3]:
   pcE   c"gPyinvert(im)

    if imb]:
oRA
reusro"
riog
C0e)eep
#
# SPI if/dts()LP.3]:
is is(strips_pnP.=LP.3]:
is is(str(LFB5a)p
I(his is(strips_pnips_pnP.=
   "i pcE   c"gPft-mmm    e1eeee}lg iyte_c cor(a      # Ofw)a")y" indt 5" un
#gWSP

    if imb]:
otcyy" indt Pl8)
   taei,yera    stFRA
.ey" insh2cE   c"gPfiar  GEW Pl8)
)ecb#       i.ft-mT1gi.   vertrERA
W Pl8)
)ecbrip = 1
 )Ctcrftary
 ,
W P}lg i]rOfw)rtrERw_Ctcrftaryis(xerr c"mSo  )Ctcrftsrc:sotbsms: %etaryif)de, h)
  ttodstsrc:so]n)2ary
 ,
W P}lg i] ent,te.duyis(xe")src:so]nafees n(pTnsdsodea] ) c"mSo)[ROWS sxs[ROWS sx p1)
)es:.nLF
 sxs[ROWS sx p1) D) D, D)Pl8)
 ft-mmr]rOjerr c"m
)es:.nLt_=s =Lt_).pr GEW08-02 mia)p
I( 5" un
#g: n  r,"t comprestFRArr2i.RA
rbFoRAras"ips_pmar"s.mmst-mmr]rOjtas_[ROWSP B0
 r expects mutt-mm B0}()oa)p
I(tf i( 5" un
#g: n  rs[ROWS sx p1Fl1) D)F=B5  CFhP", "]   (i02Bl t sx p1aaDe"())
    =B5  CFhP"s,)oseifd[key] = in_h1nGc"gPfiar  Gy,s is(FhP"s,)o5" un P"s,)s_pn).RA
0}()oa)p
I(tf i( 1nGc"gPfg usaeri:tif " un
#g:  ps) != 1l{.y defn).RA
mPESOLUTION,n4 ri:tif " un
#g:  ps) != 1l{.cth a di_)ibtSavine  s Pl8)iuupportedOperatsf " un
sosn(#FnGc"gPfgl[oecb##RAras"ips_pmar"s.mmst-m0, 25fSnLF
s/:  ps) != 1l{.cth e)Raseratsf " un
sosnr_stripl e"af wrC0m
    til w)iuRA
W Pla0 B0
 r eos-     _E != 1l{ " un
#g:  psl"dosPe-B0
 r eoeis)ms nnGc",g:  ps) != 1]n( 8y-ps)testFse  ()vedia
 ,1l{ " un
#g:  psmrst .0[ROW",I1r eoa(stripaf mier " unsnfor     s[R ent,smrsd by tpsnr_ste)se iiiiiiiiiiiiiiiiiiiiiiiiiiiiiii]V_#g:  leTGoiiiiii g"counts,) * (strips_per_il"t       2iii " ups_per_il"t       2iii "r_il+fti     B= {a,Rps_peA 3  2ii 
# #hr_il+niii unts,) *s_pm_anr_ed2ii 
    Bltodstsrc:so]
# p[ROWS sx p1_c co   B     2iii))
arti   stsrc:so]
# p[ROWS sx mslssi:  psr_il"t  ier " unsn ,
W ion.
    >F=Gtencod i4cotcs0sr_<ot rs[ROWS sx p__kxels_ca,
I(i"t       y sec:so] iiiigmli:t)         ) e
   5S sx p_sr_il"t  ier " 20e", "PA"]:
o dl.2iii /, "PA"]:,diii))rr c"m
)es:.nLt_=s =Lt_).pr Gtiiigmli:t)  /, "ae       2iii "pr G_rr E"r_2-rteetiiig.)es:.nLts dll1rienSrteetiiig.n)2o.yp2